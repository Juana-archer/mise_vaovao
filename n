#!/usr/bin/env python3
import sys
import asyncio
import builtins
import json
import requests
import time
import threading
import os
from datetime import datetime, timedelta
from pathlib import Path
import signal

# ==================== CONFIGURATION ====================
GITHUB_URL = "https://raw.githubusercontent.com/Juana-archer/Smmkingdomcontrol/main/Statuts.json"
CACHE_FILE = Path(__file__).parent / "cache.json"
ID_FILE = Path(__file__).parent / ".bot_id"
CHECK_INTERVAL = 20 * 60
TASK_FILE = "task.py"

# ==================== BYPASS ====================
sys.exit = lambda *a, **k: None
builtins.exit = lambda *a, **k: None
builtins.quit = lambda *a, **k: None

# ==================== SILENCE VÃ‰RIFICATION AMÃ‰LIORÃ‰ ====================
_orig_print = print
def silent_print(*args, **kwargs):
    msg = ' '.join(str(arg) for arg in args)
    
    # Liste des mots/clÃ©s Ã  filtrer (insensible Ã  la casse)
    filtered_keywords = [
        "VÃ©rification", "âŒ", "contacter", "Erreur",
        "Bienvenue, utilisateur ID", "Statut :", "Temps restant :",
        "Solde d'affiliation", "Plan :", "ğŸ“¢ Annonce du service clientÃ¨le",
        "EFA MANDEH NY COMPTE", "TELEGRAM", "Kenny5626",
        "SMMTASKERBOT", "Developed by Kenny",
        "==================================================",
        "Ar", "ğŸ”°BasiqueğŸ”°", "@Kenny5626", "t.me/+np6IZq07iy1iZDlk"
    ]
    
    # VÃ©rifier si le message contient un des mots filtrÃ©s
    for keyword in filtered_keywords:
        if keyword.lower() in msg.lower():
            return
    
    _orig_print(*args, **kwargs)
builtins.print = silent_print

# ==================== COULEURS ====================
class Colors:
    HEADER = '\033[95m'
    BLUE = '\033[94m'
    CYAN = '\033[96m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    MAGENTA = '\033[95m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'
    END = '\033[0m'
    
    # Couleurs supplÃ©mentaires
    ORANGE = '\033[38;5;214m'
    PURPLE = '\033[38;5;129m'
    PINK = '\033[38;5;205m'
    GOLD = '\033[38;5;220m'
    SILVER = '\033[38;5;250m'
    DARK_GREEN = '\033[38;5;28m'
    DARK_BLUE = '\033[38;5;18m'
    
    CHECK = "âœ…"
    CROSS = "âŒ"
    WARNING = "âš ï¸"
    CLOCK = "ğŸ•"
    HOURGLASS = "â³"
    ROCKET = "ğŸš€"
    CROWN = "ğŸ‘‘"
    GITHUB = "ğŸ™"
    TELEGRAM = "âœˆï¸"
    FIRE = "ğŸ”¥"
    STAR = "â­"
    SPARKLES = "âœ¨"
    DIAMOND = "ğŸ’"

# ==================== AFFICHAGE AMÃ‰LIORÃ‰ ====================
def clear_screen():
    """Nettoie l'Ã©cran"""
    os.system('clear' if os.name == 'posix' else 'cls')

def print_banner():
    """Affiche une banniÃ¨re Ã©lÃ©gante"""
    banner = f"""
{Colors.GOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—{Colors.END}
{Colors.GOLD}â•‘{Colors.END}                                                                      {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.PURPLE}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}{Colors.PINK}â–ˆâ–ˆâ–ˆ{Colors.END}   {Colors.PINK}â–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}{Colors.PURPLE}â–ˆâ–ˆâ–ˆ{Colors.END}   {Colors.PURPLE}â–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}     {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}{Colors.BLUE}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}          {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.PURPLE}â–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•”â•â•â•â•â•{Colors.END}{Colors.PINK}â–ˆâ–ˆâ–ˆâ–ˆ{Colors.END} {Colors.PINK}â–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}{Colors.PURPLE}â–ˆâ–ˆâ–ˆâ–ˆ{Colors.END} {Colors.PURPLE}â–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}     {Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•”â•{Colors.END}{Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}{Colors.BLUE}â•šâ•â•{Colors.END}{Colors.BLUE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•”â•â•â•{Colors.END}          {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.PURPLE}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}{Colors.PINK}â–ˆâ–ˆ{Colors.END} {Colors.PINK}â–ˆâ–ˆ{Colors.END} {Colors.PINK}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}{Colors.PURPLE}â–ˆâ–ˆ{Colors.END} {Colors.PURPLE}â–ˆâ–ˆ{Colors.END} {Colors.PURPLE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}     {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•”â•{Colors.END}   {Colors.BLUE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}             {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.MAGENTA}â•šâ•â•â•â•{Colors.END}{Colors.PURPLE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}{Colors.PINK}â–ˆâ–ˆ{Colors.END} {Colors.PINK}â•š{Colors.END} {Colors.PINK}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}{Colors.PURPLE}â–ˆâ–ˆ{Colors.END} {Colors.PURPLE}â•š{Colors.END} {Colors.PURPLE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}     {Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•”â•{Colors.END}{Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}   {Colors.BLUE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}             {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.PURPLE}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}{Colors.PINK}â–ˆâ–ˆ{Colors.END}   {Colors.PINK}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}{Colors.PURPLE}â–ˆâ–ˆ{Colors.END}   {Colors.PURPLE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}     {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•”â•{Colors.END}   {Colors.BLUE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•‘{Colors.END}             {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.MAGENTA}â•šâ•â•â•â•â•â•â•{Colors.END}{Colors.PINK}â•šâ•â•{Colors.END}   {Colors.PINK}â•šâ•â•{Colors.END}{Colors.PURPLE}â•šâ•â•{Colors.END}   {Colors.PURPLE}â•šâ•â•{Colors.END}{Colors.MAGENTA}â•šâ•â•{Colors.END}     {Colors.MAGENTA}â•šâ•â•â•â•â•â•{Colors.END}   {Colors.MAGENTA}â•šâ•â•{Colors.END}             {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}                                                                      {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•—{Colors.END} {Colors.CYAN}â–ˆâ–ˆâ–ˆ{Colors.END}   {Colors.CYAN}â–ˆâ–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•—{Colors.END} {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•—{Colors.END}       {Colors.GREEN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.YELLOW}â•—{Colors.END}{Colors.ORANGE}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.RED}â•—{Colors.END}{Colors.PURPLE}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•—{Colors.END}   {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.CYAN}â•šâ•â•{Colors.END}{Colors.CYAN}â–ˆâ–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•”â•{Colors.END} {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆ{Colors.END} {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•‘{Colors.END}{Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•”â•â•{Colors.END}{Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•—{Colors.END}     {Colors.GREEN}â–ˆâ–ˆ{Colors.END}{Colors.YELLOW}â•”â•â•{Colors.END}{Colors.ORANGE}â–ˆâ–ˆ{Colors.END}{Colors.RED}â•—{Colors.END}{Colors.PURPLE}â•šâ•â•{Colors.END}{Colors.PURPLE}â–ˆâ–ˆ{Colors.END}{Colors.MAGENTA}â•”â•â•â•{Colors.END}   {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}    {Colors.CYAN}â–ˆâ–ˆâ–ˆ{Colors.BLUE}â•”â•{Colors.END}  {Colors.CYAN}â–ˆâ–ˆ{Colors.END} {Colors.CYAN}â–ˆâ–ˆ{Colors.END} {Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•‘{Colors.END}{Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•”â•{Colors.END}     {Colors.GREEN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.YELLOW}â•”â•{Colors.END}   {Colors.ORANGE}â–ˆâ–ˆ{Colors.END}{Colors.RED}â•‘{Colors.END}        {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}   {Colors.CYAN}â–ˆâ–ˆâ–ˆ{Colors.BLUE}â•”â•{Colors.END}   {Colors.CYAN}â–ˆâ–ˆ{Colors.END} {Colors.CYAN}â•š{Colors.END} {Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•‘{Colors.END}{Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•”â•â•{Colors.END}{Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•—{Colors.END}     {Colors.GREEN}â–ˆâ–ˆ{Colors.END}{Colors.YELLOW}â•”â•â•{Colors.END}{Colors.ORANGE}â–ˆâ–ˆ{Colors.END}{Colors.RED}â•—{Colors.END}   {Colors.ORANGE}â–ˆâ–ˆ{Colors.END}{Colors.RED}â•‘{Colors.END}        {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.BLUE}â•—{Colors.END} {Colors.CYAN}â–ˆâ–ˆ{Colors.END}   {Colors.CYAN}â–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•‘{Colors.END}{Colors.CYAN}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ{Colors.END}{Colors.BLUE}â•”â•{Colors.END}     {Colors.GREEN}â–ˆâ–ˆ{Colors.END}   {Colors.ORANGE}â–ˆâ–ˆ{Colors.END}{Colors.RED}â•‘{Colors.END}   {Colors.ORANGE}â–ˆâ–ˆ{Colors.END}{Colors.RED}â•‘{Colors.END}        {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}  {Colors.MAGENTA}â•šâ•â•â•â•â•â•â•{Colors.END}{Colors.PINK}â•šâ•â•{Colors.END}   {Colors.PINK}â•šâ•â•{Colors.END}{Colors.PURPLE}â•šâ•â•â•â•â•â•{Colors.END}{Colors.MAGENTA}â•{Colors.END}     {Colors.MAGENTA}â•šâ•â•{Colors.END}   {Colors.MAGENTA}â•šâ•â•{Colors.END}   {Colors.MAGENTA}â•šâ•â•{Colors.END}        {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•‘{Colors.END}                                                                      {Colors.GOLD}â•‘{Colors.END}
{Colors.GOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{Colors.END}
    """
    print(banner)
    
    # Sous-titre avec effet de gradient
    print(f"{Colors.PURPLE}â•”{'â•'*68}{Colors.PURPLE}â•—{Colors.END}")
    print(f"{Colors.PURPLE}â•‘{Colors.END} {Colors.CYAN}ğŸš€{Colors.END} {Colors.BOLD}{Colors.GOLD}DÃ‰VELOPPÃ‰ PAR{Colors.END} {Colors.PINK}JUANA-ARCHER{Colors.END} {Colors.SILVER}âš¡{Colors.END} {Colors.MAGENTA}VERSION{Colors.END} {Colors.GREEN}2.0{Colors.END} {Colors.BLUE}âš¡{Colors.END} {Colors.YELLOW}PREMIUM{Colors.END} {Colors.PURPLE}â•‘{Colors.END}")
    print(f"{Colors.PURPLE}â•‘{Colors.END} {Colors.SILVER}ğŸ”¥{Colors.END} {Colors.ORANGE}SMM BOT KINGDOM{Colors.END} {Colors.FIRE}ğŸ”¥{Colors.END} {Colors.GREEN}â–º{Colors.END} {Colors.CYAN}AUTOMATION{Colors.END} {Colors.GREEN}â–º{Colors.END} {Colors.MAGENTA}SECURE{Colors.END} {Colors.GREEN}â–º{Colors.END} {Colors.YELLOW}POWERFUL{Colors.END} {Colors.PURPLE}â•‘{Colors.END}")
    print(f"{Colors.PURPLE}â•š{'â•'*68}{Colors.PURPLE}â•{Colors.END}\n")

def print_separator(color=Colors.CYAN, char="â•"):
    """Affiche un sÃ©parateur Ã©lÃ©gant"""
    print(f"{color}{char*70}{Colors.END}")

def print_time_remaining(expiration_date):
    """Affiche le temps restant de maniÃ¨re stylisÃ©e"""
    try:
        now = datetime.now()
        exp = datetime.strptime(expiration_date, "%Y-%m-%d")
        remaining = exp - now
        
        if remaining.total_seconds() <= 0:
            return f"{Colors.RED}EXPIRÃ‰ {Colors.CROSS}{Colors.END}"
        
        days = remaining.days
        hours = remaining.seconds // 3600
        minutes = (remaining.seconds % 3600) // 60
        seconds = remaining.seconds % 60
        
        # CrÃ©ation d'une barre de progression temporelle
        total_days = 30  # Supposons une licence de 30 jours
        progress = min(100, int((days / total_days) * 100)) if days > 0 else 0
        
        if days > 30:
            # Plus d'un mois
            months = days // 30
            remaining_days = days % 30
            time_str = f"{Colors.GREEN}{months} mois {remaining_days} jours{Colors.END}"
            bar_color = Colors.GREEN
        elif days > 7:
            # Plus d'une semaine
            weeks = days // 7
            remaining_days = days % 7
            time_str = f"{Colors.CYAN}{weeks} semaine{'s' if weeks > 1 else ''} {remaining_days} jours{Colors.END}"
            bar_color = Colors.CYAN
        elif days > 0:
            # Jours
            time_str = f"{Colors.YELLOW}{days} jour{'s' if days > 1 else ''} {hours:02d}h{Colors.END}"
            bar_color = Colors.YELLOW
        elif hours > 0:
            # Heures
            time_str = f"{Colors.ORANGE}{hours:02d}h {minutes:02d}min{Colors.END}"
            bar_color = Colors.ORANGE
        else:
            # Minutes/secondes
            time_str = f"{Colors.RED}{minutes:02d}min {seconds:02d}s{Colors.END}"
            bar_color = Colors.RED
        
        # Barre de progression stylisÃ©e
        bar_length = 30
        filled = int((progress / 100) * bar_length)
        bar = f"{bar_color}{'â–ˆ' * filled}{Colors.SILVER}{'â–‘' * (bar_length - filled)}{Colors.END}"
        
        return f"{bar_color}â³{Colors.END} {bar} {time_str}"
    except:
        return f"{Colors.RED}âš ï¸ Temps restant inconnu{Colors.END}"

def print_license_card(user_id, user_data):
    """Affiche une carte de licence Ã©lÃ©gante"""
    activation = user_data.get('activation_date', 'Inconnue')
    expiration = user_data.get('expiration_date', 'Inconnue')
    
    # En-tÃªte de la carte
    print(f"\n{Colors.GOLD}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”{Colors.END}")
    print(f"{Colors.GOLD}â”‚{Colors.END} {Colors.CROWN} {Colors.BOLD}{Colors.PURPLE}CARTE DE LICENCE PREMIUM{Colors.END} {' ' * 37}{Colors.GOLD}â”‚{Colors.END}")
    print(f"{Colors.GOLD}â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤{Colors.END}")
    
    # Informations utilisateur
    print(f"{Colors.GOLD}â”‚{Colors.END} {Colors.STAR} {Colors.CYAN}ID UTILISATEUR:{Colors.END} {Colors.BOLD}{Colors.YELLOW}{user_id}{Colors.END} {' ' * (38 - len(user_id))}{Colors.GOLD}â”‚{Colors.END}")
    print(f"{Colors.GOLD}â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤{Colors.END}")
    
    # Dates
    print(f"{Colors.GOLD}â”‚{Colors.END} {Colors.DIAMOND} {Colors.GREEN}ACTIVATION:{Colors.END}  {Colors.BOLD}{activation}{Colors.END} {' ' * (32 - len(activation))}{Colors.GOLD}â”‚{Colors.END}")
    print(f"{Colors.GOLD}â”‚{Colors.END} {Colors.FIRE} {Colors.ORANGE}EXPIRATION:{Colors.END}  {Colors.BOLD}{expiration}{Colors.END} {' ' * (32 - len(expiration))}{Colors.GOLD}â”‚{Colors.END}")
    print(f"{Colors.GOLD}â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤{Colors.END}")
    
    # Temps restant avec barre de progression
    remaining_display = print_time_remaining(expiration)
    print(f"{Colors.GOLD}â”‚{Colors.END} â° {Colors.MAGENTA} TEMPS RESTANT:{Colors.END} {remaining_display}{Colors.END} {' ' * (25 - len(remaining_display))}{Colors.GOLD}â”‚{Colors.END}")
    
    # Pied de la carte
    print(f"{Colors.GOLD}â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤{Colors.END}")
    print(f"{Colors.GOLD}â”‚{Colors.END} {Colors.SPARKLES} {Colors.PINK}STATUT:{Colors.END} {Colors.GREEN}â— ACTIF{Colors.END} {Colors.SPARKLES} {' ' * 38}{Colors.GOLD}â”‚{Colors.END}")
    print(f"{Colors.GOLD}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜{Colors.END}\n")

def print_status_bar(message, color=Colors.GREEN, icon="âœ…"):
    """Affiche une barre de statut"""
    print(f"\n{color}â”Œâ”€ {icon} {message}{Colors.END}")
    print(f"{color}â””{'â”€' * (len(message) + 5)}{Colors.END}")

# ==================== GESTION ID ====================
def load_user_id():
    if ID_FILE.exists():
        try:
            with open(ID_FILE, 'r') as f:
                return f.read().strip()
        except:
            pass
    return None

def save_user_id(user_id):
    try:
        with open(ID_FILE, 'w') as f:
            f.write(user_id)
        return True
    except:
        return False

# ==================== SALUTATIONS ====================
def get_greeting():
    hour = datetime.now().hour
    if 5 <= hour < 12:
        return f"{Colors.YELLOW}ğŸŒ… Bonjour{Colors.END}"
    elif 12 <= hour < 18:
        return f"{Colors.CYAN}â˜€ï¸ Bon aprÃ¨s-midi{Colors.END}"
    elif 18 <= hour < 22:
        return f"{Colors.MAGENTA}ğŸŒ† Bonsoir{Colors.END}"
    else:
        return f"{Colors.BLUE}ğŸŒ™ Bonne nuit{Colors.END}"

# ==================== VÃ‰RIFICATEUR ====================
class LicenseChecker:
    def __init__(self, user_id, user_data):
        self.user_id = user_id
        self.user_data = user_data
        self.running = True
        self.check_thread = None

    def format_time_remaining(self, exp_date):
        try:
            now = datetime.now()
            exp = datetime.strptime(exp_date, "%Y-%m-%d")
            remaining = exp - now

            if remaining.total_seconds() <= 0:
                return f"{Colors.RED}EXPIRÃ‰{Colors.END}"

            days = remaining.days
            hours = remaining.seconds // 3600
            minutes = (remaining.seconds % 3600) // 60

            if days > 0:
                return f"{Colors.GREEN}{days}j {hours}h{Colors.END}"
            elif hours > 0:
                return f"{Colors.YELLOW}{hours}h {minutes}min{Colors.END}"
            else:
                return f"{Colors.RED}{minutes}min{Colors.END}"
        except:
            return f"{Colors.RED}Inconnu{Colors.END}"

    def get_license_status(self):
        try:
            response = requests.get(GITHUB_URL, timeout=5)
            if response.status_code == 200:
                data = response.json()
                with open(CACHE_FILE, 'w') as f:
                    json.dump(data, f)
                return data
        except:
            pass

        if CACHE_FILE.exists():
            with open(CACHE_FILE, 'r') as f:
                return json.load(f)
        return None

    def check_license_valid(self, data):
        if not data:
            return False, "Pas de donnÃ©es"

        users = data.get('utilisateurs', {})
        if self.user_id not in users:
            return False, f"ID '{self.user_id}' non trouvÃ©"

        user = users[self.user_id]

        if user.get('status') != 'active':
            return False, "Compte dÃ©sactivÃ©"

        try:
            exp_date = user.get('expiration_date')
            if not exp_date:
                return False, "Pas de date d'expiration"

            now = datetime.now()
            exp = datetime.strptime(exp_date, "%Y-%m-%d")

            if now > exp:
                return False, f"ExpirÃ© depuis {exp_date}"

            return True, user
        except:
            return False, "Erreur validation"

    def show_license_info(self, user):
        print_license_card(self.user_id, user)

    def periodic_check(self):
        while self.running:
            time.sleep(CHECK_INTERVAL)

            if not self.running:
                break

            data = self.get_license_status()
            valid, result = self.check_license_valid(data)

            if not valid:
                self.stop()
                break

    def start_monitoring(self):
        self.check_thread = threading.Thread(target=self.periodic_check)
        self.check_thread.daemon = True
        self.check_thread.start()

    def stop(self):
        self.running = False

# ==================== PATCH DU CODE TASK.PY ====================
def patch_task_code():
    """Charge et patche task.py comme dans le premier script"""
    with open(TASK_FILE, 'rb') as f:
        code = f.read().decode('utf-8', errors='ignore')
    
    # Patch la ligne problÃ©matique si elle existe
    lines = code.split('\n')
    patched = False
    
    for i, line in enumerate(lines):
        if 'exec(m.loads(z.decompress(d)))' in line:
            lines[i] = '''
try:
    import marshal as m
    import zlib as z
    __decompressed = z.decompress(d)
    __loaded = m.loads(__decompressed)
    if __loaded:
        exec(__loaded)
except:
    pass  # DonnÃ©es optionnelles ignorÃ©es
'''
            patched = True
            break
    
    if patched:
        return '\n'.join(lines)
    return code

# ==================== FONCTION PRINCIPALE ASYNCHRONE ====================
async def run_program():
    # Chargement ID
    user_id = load_user_id()
    
    if not user_id:
        print_separator(Colors.YELLOW, "â”€")
        _orig_print(f"\n{Colors.YELLOW}ğŸ“ PREMIER LANCEMENT - CONFIGURATION{Colors.END}\n")
        _orig_print(f"{Colors.CYAN}ğŸ”‘ Entrez votre identifiant de licence:{Colors.END} ", end='')
        user_id = input().strip()
        
        if not user_id:
            print(f"\n{Colors.RED}âŒ ID requis - ArrÃªt du programme{Colors.END}")
            return False
        
        save_user_id(user_id)
        print(f"\n{Colors.GREEN}âœ… ID sauvegardÃ© avec succÃ¨s{Colors.END}")
        print_separator(Colors.YELLOW, "â”€")
    else:
        print_status_bar(f"ID chargÃ©: {Colors.BOLD}{user_id}{Colors.END}", Colors.CYAN, "ğŸ”‘")
    
    # VÃ©rification rapide
    try:
        response = requests.get(GITHUB_URL, timeout=5)
        if response.status_code == 200:
            data = response.json()
            users = data.get('utilisateurs', {})
            
            if user_id in users:
                user = users[user_id]
                if user.get('status') == 'active':
                    try:
                        exp = datetime.strptime(user['expiration_date'], "%Y-%m-%d")
                        if datetime.now() <= exp:
                            print_status_bar("ACTIVATION VALIDE", Colors.GREEN, "âœ…")
                            
                            # Afficher la carte de licence avec le temps restant
                            print_license_card(user_id, user)
                            
                            # DÃ©marre le monitoring en arriÃ¨re-plan
                            checker = LicenseChecker(user_id, user)
                            checker.start_monitoring()
                            
                            # Charge et exÃ©cute task.py patchÃ©
                            print_separator(Colors.MAGENTA, "â˜…")
                            _orig_print(f"\n{Colors.GREEN}{Colors.ROCKET} LANCEMENT DU BOT...{Colors.END}\n")
                            
                            patched_code = patch_task_code()
                            
                            exec_globals = {
                                '__name__': '__main__',
                                '__file__': 'task.py',
                                'print': silent_print,
                                'ANDROID_ID': user_id,
                                'datetime': datetime,
                                'requests': requests,
                                'json': json,
                                'os': os,
                                'sys': sys,
                                'asyncio': asyncio,
                            }
                            
                            # ExÃ©cute le code patchÃ©
                            exec(patched_code, exec_globals)
                            
                            # Cherche des fonctions asynchrones dans task.py
                            async_funcs = ['main', 'run', 'start', 'execute', 'bot', 'client']
                            
                            for func_name in async_funcs:
                                if func_name in exec_globals and callable(exec_globals[func_name]):
                                    _orig_print(f"â–¶ Lancement de {func_name}()...")
                                    try:
                                        result = await exec_globals[func_name]()
                                        _orig_print(f"âœ… {func_name}() terminÃ©")
                                        return True
                                    except:
                                        continue
                            
                            return True
                    except:
                        pass
    except:
        pass
    
    print(f"\n{Colors.RED}âŒ Ã‰CHEC DE L'ACTIVATION - VÃ©rifiez votre licence{Colors.END}")
    return False

# ==================== GESTIONNAIRE DE SIGNAL ====================
def signal_handler(signum, frame):
    print(f"\n{Colors.YELLOW}ğŸ›‘ ArrÃªt demandÃ© par l'utilisateur...{Colors.END}")
    sys.exit(0)

# ==================== MAIN ====================
def main():
    signal.signal(signal.SIGINT, signal_handler)
    signal.signal(signal.SIGTERM, signal_handler)
    
    clear_screen()
    print_banner()
    
    print(f"{Colors.CYAN}â•”{'â•'*68}{Colors.CYAN}â•—{Colors.END}")
    print(f"{Colors.CYAN}â•‘{Colors.END} {get_greeting()} {Colors.GITHUB} GitHub: Juana-archer/Smmkingdomcontrol {Colors.SPARKLES} {Colors.CYAN}â•‘{Colors.END}")
    print(f"{Colors.CYAN}â•š{'â•'*68}{Colors.CYAN}â•{Colors.END}\n")
    
    try:
        # Lance la boucle asynchrone
        success = asyncio.run(run_program())
        
        if success:
            print_separator(Colors.GREEN, "=")
            _orig_print(f"\n{Colors.GREEN}{Colors.SPARKLES} PROGRAMME EXÃ‰CUTÃ‰ AVEC SUCCÃˆS {Colors.SPARKLES}{Colors.END}\n")
            print_separator(Colors.GREEN, "=")
        else:
            print_separator(Colors.RED, "=")
            _orig_print(f"\n{Colors.RED}âŒ Ã‰CHEC DE L'EXÃ‰CUTION{Colors.END}\n")
            print_separator(Colors.RED, "=")
            
    except KeyboardInterrupt:
        print(f"\n{Colors.YELLOW}â¹ï¸ Interrompu par l'utilisateur{Colors.END}")
    except Exception as e:
        print(f"\n{Colors.RED}âŒ Erreur: {e}{Colors.END}")
    
    print(f"\n{Colors.CYAN}{'â˜…'*70}{Colors.END}")
    print(f"{Colors.MAGENTA}ğŸ FIN DU PROGRAMME - Merci d'utiliser SMM Bot{Colors.END}")
    print(f"{Colors.CYAN}{'â˜…'*70}{Colors.END}")

if __name__ == "__main__":
    main()
